<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Fantastic DSLs</title>
    <meta name="description" content="replace this description">
    <meta name="author" content="put your name here">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <!-- Base styles -->
    <link rel="stylesheet" href="components/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="css/build/theme.css" id="theme">
    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="components/reveal.js/lib/css/zenburn.css">
    <!-- Printing and PDF exports -->
    <script type="text/javascript">
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ?
            'components/reveal.js/css/print/pdf.css' :
            'components/reveal.js/css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>
    <!--[if lt IE 9]>
    <script src="components/reveal.js/lib/js/html5shiv.js"></script>
    <![endif]-->
    <style>
        td {
            padding: 0 !important;
        }

        code {
            width: 100%;
            max-height: 600px !important;
        }
    </style>
</head>
<body>
<div class="reveal">
    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section data-background-image="img/1.jpg">
            <div style="font-size: 110px; font-family: Harry P, fantasy">
                <p>Fantastic
                <p>
                <p style="font-size: 180px">DSLs
                <p>
                <p>and where to find them</p>
            </div>
        </section>

        <section data-background-image="img/4.png">
            <style>
                img {
                    background: none !important;
                    border: 0 !important;
                }
            </style>
            <img src="img/canva.png" height="280px">
            <p style="text-align: left; margin-left: 100px">
                <br>Sergey Tselovalnikov
                <br><a href="http://serce.me">http://serce.me</a>
                <br><a href="http://github.com/SerCeMan">GitHub @SerCeMan</a>
                <br><a href="http://twitter.com/SerCeMan">Twitter @SerCeMan</a>
                <br>
                <img src="img/kotlin.png" height="100px">
            </p>

        </section>

        <section data-background-image="img/5.png">
            <h1>Warning</h1>
        </section>


        <section data-background-image="img/2.jpg">
            <h1>What is DSL</h1>
            <div style="text-align: left;">
                <blockquote class="fragment fade-in" style="background-color: #242424">
                    <span style="opacity: 0.7">A computer programming</span>
                    <span style="color: #ff9900;">language</span>
                    <span style="opacity: 0.7"> of limited expressiveness </span>
                    <span style="color: #ff9900;">focused</span><span style="opacity: 0.7"> on a particular </span>
                    <span style="color: #ff9900;">domain</span>
                    <footer>— <cite>Martin Fowler</cite></footer>
                </blockquote>

                <blockquote class="fragment fade-in" style="background-color: #242424">
                    <span style="opacity: 0.7">A</span>
                    <span style="color: #ff9900;">language </span>
                    <span style="opacity: 0.7">(or a set of abstractions)</span>
                    <span style="opacity: 0.7">that's built to deal with a </span>
                    <span style="color: #ff9900;">specific domain</span>
                </blockquote>
            </div>
        </section>

        <section>
            <h2>Calling conventions</h2>
            <pre class="fragment fade-in" data-fragment-index="1" style="padding-bottom: 30px"><code data-trim class="kotlin hljs">
fun dotimes(n: Int, f: () -> Unit) {
    for (i in 0..n-1) {
        f()
    }
}
            </code></pre>
            <pre class="fragment fade-in" data-fragment-index="2" style="padding-bottom: 30px"><code class="kotlin hljs" data-trim>
dotimes(5, {
    println("Hello, Kotlin!")
})
            </code></pre>
            <pre class="fragment fade-in" data-fragment-index="3" style="padding-bottom: 30px"><code class="java hljs" data-trim>
dotimes(5) {
    println("Hello, Kotlin!")
}
            </code></pre>
            <pre class="fragment fade-in" data-fragment-index="4"><code class="java hljs" data-trim>
do5times {
    println("Hello, Kotlin!")
}
            </code></pre>
        </section>

        <section>
            <h2>Extension functions</h2>
            <table width="100%">
                <tr>
                    <td>
                        <pre class="fragment fade-in" data-fragment-index="1" style="padding-bottom: 30px"><code data-trim class="kotlin hljs">
@@include('ext1/f1.kts')
                        </code></pre>
                        <pre class="fragment fade-in" data-fragment-index="3"><code class="kotlin hljs" data-trim>
@@include('ext1/f2.kt')
                        </code></pre>
                    </td>
                    <td class="code">
                        <pre class="fragment fade-in" data-fragment-index="2"><code class="java hljs" data-trim>
@@include('ext1/f3.jv')
                        </code></pre>
                    </td>
                </tr>
            </table>

        </section>


        <!--<section>-->
            <!--<h2>Extension functions</h2>-->
            <!--<table width="100%">-->
                <!--<tr>-->
                    <!--<td>-->
                        <!--<pre><code style="overflow: hidden; width: 100%" class="kotlin hljs" data-trim>-->
<!--@@include('ext2/f1.kts')-->
                        <!--</code></pre>-->
                    <!--</td>-->
                    <!--<td  class="fragment fade-in">-->
                        <!--<pre><code style="overflow: hidden; width: 100%" class="java hljs" data-trim>-->
<!--@@include('ext2/f2.jv')-->
                        <!--</code></pre>-->
                    <!--</td>-->
                <!--</tr>-->
            <!--</table>-->

        <!--</section>-->


        <section style="padding: 0">
            <h2>droid DSL</h2>
            <table width="100%">
                <tr>
                    <td>
                        <pre><code class="kotlin hljs" data-trim>
@@include('ext3/f1.kts')
                        </code></pre>
                        <pre class="fragment fade-in"><code class="java hljs" data-trim>
fun on(cmd: String, f: Droid.() -> Unit) {
// ...
  droid.f()
// ...
}

//

on("back") {
  moveLeft()
  if (peopleAround) {
    fire(gun)
  }
}
                        </code></pre>
                    </td>
                    <td class="code">
                        <pre class="fragment fade-in"><code class="java hljs" data-trim>
@@include('ext3/f2.jv')
                        </code></pre>
                    </td>
                </tr>
            </table>

        </section>

        <section>
            <h2>HTML</h2>
            <a href="https://github.com/Kotlin/kotlinx.html">github.com/Kotlin/kotlinx.html</a>
            <pre><code style="overflow: hidden; width: 100%" class="kotlin hljs" data-trim>
@@include('html/f1.kts')
</code></pre>
        </section>


        <section>
            <h2>IDE</h2>
        </section>


        <section>
            <h2>Teamcity DSL</h2>
            <a href="https://blog.jetbrains.com/teamcity/2016/11/kotlin-configuration-scripts-an-introduction/">blog.jetbrains.com/teamcity/2016/11/kotlin-configuration-scripts-an-introduction/</a>
            <pre><code style="overflow: hidden; width: 100%" class="kotlin hljs" data-trim>
object Project : Project({
  uuid = "my_project_id"
  extId = "ExampleOfDSL"
  name = "Example of DSL"

  val vcsRoot = GitVcsRoot({
    uuid = "my_vcs_root_id"
    url = "..."
  })
  buildType {
    name = "Build"
    buildNumberPattern = "%build.counter%"
    vcs {
      root(vcsRoot)
    }
    maven {
      goals = "clean test"
    }
  }
})
</code></pre>
        </section>


        <section>
            <h2>Gradle Kotlin</h2>
            <a href="https://github.com/gradle/gradle-script-kotlin">github.com/gradle/gradle-script-kotlin</a>
            <pre><code style="overflow: hidden; width: 100%" class="kotlin hljs" data-trim>
apply {
    plugin("com.android.application")
    plugin("kotlin-android")
}

android {
    buildToolsVersion("25.0.0")
    compileSdkVersion(23)

    defaultConfig {
        minSdkVersion(15)

        applicationId = "com.example.kotlingradle"
    }
}

dependencies {
    compile("com.android.support:appcompat-v7:23.4.0")
    compile(kotlinModule("stdlib"))
}
</code></pre>
        </section>

        <section>
            <h2>Spek</h2>
            <a href="http://spekframework.org">spekframework.org</a>
            <pre><code style="overflow: hidden; width: 100%" class="kotlin hljs" data-trim>
object SimpleSpec: Spek({
    describe("a calculator") {
        val calculator = SampleCalculator()

        on("addition") {
            val sum = calculator.sum(2, 4)

            it("should return the result of adding") {
                assertEquals(6, sum)
            }
        }

        on("subtraction") {
            val subtract = calculator.subtract(4, 2)

            it("should return the result of subtracting") {
                assertEquals(2, subtract)
            }
        }
    }
})
            </code></pre>
        </section>



        <section>
            <h2>Anko</h2>
            <a href="https://github.com/Kotlin/anko">github.com/Kotlin/anko</a>
            <pre><code style="overflow: hidden; width: 100%" class="kotlin hljs" data-trim>
override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)

    verticalLayout {
        padding = dip(30)
        editText {
            hint = "Name"
            textSize = 24f
        }
        editText {
            hint = "Password"
            textSize = 24f
        }
        button("Login") {
            textSize = 26f
        }
    }
}
            </code></pre>
        </section>


        <section>
            <h2>Domain</h2>
            <img style="border: 0 !important;" width="800px" src="img/domain.svg">
        </section>


        <section>
            <h2>Data classes</h2>
            <table width="100%">
                <tr>
                    <td style="width: 50%">
                        <pre style="padding-bottom: 30px"><code data-trim class="kotlin hljs">
@@include('domain/data1.kt')
                        </code></pre>
                    </td>
                    <td class="fragment fade-in" data-fragment-index="2" style="width: 50%">
                        <pre><code class="kotlin hljs" data-trim>
@@include('domain/data3.kt')
                        </code></pre>
                    </td>
                </tr>
                <tr>
                    <td class="fragment fade-in" data-fragment-index="1" style="width: 50%">
                        <pre><code class="kotlin hljs" data-trim>
@@include('domain/data2.kt')
                        </code></pre>
                    </td>
                    <td class="fragment fade-in" data-fragment-index="3" style="width: 50%">
                        <pre><code class="kotlin hljs" data-trim>
@@include('domain/data4.kt')
                        </code></pre>
                    </td>
                </tr>

            </table>
        </section>

        <section>
            <h2>Data classes</h2>
            <pre style="font-size: 18px"><code class="kotlin hljs" data-trim>
// update 2
val stansTrs2 = trs.copy(
  parts = trs.parts.copy(
    from = trs.parts.from.copy(
      person = trs.parts.from.person.copy(
        parts = trs.parts.from.person.parts.copy(
          from = trs.parts.from.person.parts.from.copy(
            person = trs.parts.from.person.parts.from.person.copy(
              parts = trs.parts.from.person.parts.from.person.parts.copy(
                from = trs.parts.from.person.parts.from.person.parts.from.copy(
                  person = trs.parts.from.person.parts.from.person.parts.from.person.copy(
                    parts = trs.parts.from.person.parts.from.person.parts.from.person.parts.copy(
                      from = trs.parts.from.person.parts.from.person.parts.from.person.parts.from.copy(
                        name = "jonh"
                      )
                    )
                  )
                )
              )
            )
          )
        )
      )
    )
  )
)
            </code></pre>
        </section>


        <section>
            <h2>Clojure way</h2>
            <table width="100%">
                <tr>
                    <td style="width: 55%">
                        <pre><code style="overflow: hidden; width: 100%" class="clojure hljs" data-trim>
@@include('domain/cljv.clj')
                        </code></pre>
                        <pre class="fragment fade-in"><code style="overflow: hidden; width: 100%" class="clojure hljs" data-trim>
; update
(def ts2 (assoc-in ts [:parts :from :name] "john"))
                        </code></pre>
                    </td>
                    <td style="width: 50%; vertical-align: top" class="code">
                        <img src="img/kotlin_domain_2.png">
                    </td>
                </tr>
            </table>
        </section>


        <section>
            <h2>Persistent Data Structures</h2>
            <table width="100%">
                <tr>
                    <td style="width: 50%">
                        <pre style="padding-bottom: 30px"><code data-trim class="kotlin hljs">
@@include('domain/clj1.kt')
                        </code></pre>
                    </td>
                    <td style="width: 50%">
                        <pre class="fragment fade-in"><code class="kotlin hljs" data-trim>
@@include('domain/clj2.kt')
                        </code>
                        <img src="img/kotlin_domain_2.png"></pre>
                    </td>
                </tr>
            </table>
        </section>


        <section>
            <h2>Extension function on generic types</h2>
            <pre><code style="overflow: hidden; width: 100%" class="kotlin hljs" data-trim>
fun Collection&lt;Int&gt;.toIntArray(): IntArray {
  val result = IntArray(size)
  var index = 0
  for (element in this)
    result[index++] = element
  return result
}
            </code></pre>
        </section>


        <section data-background-image="img/niffler.jpg">
            <h2>Delegated Properties</h2>
            <table width="100%">
                <tr>
                    <td>
                        <pre><code style="overflow: hidden; width: 100%" class="kotlin hljs" data-trim>
@@include('del/f1.kts')
                        </code></pre>
                    </td>
                    <td class="code">
                        <pre class="fragment fade-in"><code style="overflow: hidden; width: 100%" class="java hljs" data-trim>
@@include('del/f2.jv')
                        </code></pre>
                    </td>
                </tr>
            </table>
        </section>

        <section>
            <h2>Kotlin DSL</h2>
            <table width="100%">
                <tr>
                    <td style="width: 50%">
                        <pre style="padding-bottom: 30px; font-size: 16px"><code data-trim>
interface Transaction
val &lt;F&gt; Cursor&lt;Transaction, F&gt;.payment by Node&lt;Payment&gt;()
val &lt;F&gt; Cursor&lt;Transaction, F&gt;.parts by Node&lt;Parts&gt;()

interface Payment
val &lt;F&gt; Cursor&lt;Payment, F&gt;.currency by Leaf&lt;String&gt;()
val &lt;F&gt; Cursor&lt;Payment, F&gt;.amount by Leaf&lt;Int&gt;()

interface Parts
val &lt;F&gt; Cursor&lt;Parts, F&gt;.to by Node&lt;Person&gt;()
val &lt;F&gt; Cursor&lt;Parts, F&gt;.from by Node&lt;Person&gt;()

interface Person
val &lt;F&gt; Cursor&lt;Person, F&gt;.id by Leaf&lt;Int&gt;()
val &lt;F&gt; Cursor&lt;Person, F&gt;.name by Leaf&lt;String&gt;()
                        </code></pre>
                    </td>
                    <td style="width: 50%">
                        <pre class="fragment fade-in"><code class="kotlin hljs" data-trim>
// create
val trans = domain&lt;Transaction&gt; {
  (payment) {
    currency.set(&quot;AUD&quot;)
    amount.set(15)
  }
  (parts) {
    (from) {
      id.set(0)
      name.set(&quot;alex&quot;)
    }
    (to) {
      id.set(1)
      name.set(&quot;ben&quot;)
    }
  }
}
                        </code></pre>
                        <pre class="fragment fade-in"><code class="kotlin hljs" data-trim>
// update
val trans2 = trans.cursor.parts.from.update {
  name.set("john")
}
                        </code></pre>
                    </td>
                </tr>

            </table>
        </section>


        <section>
            <img style="border: 0 !important;" width="800px" src="img/domain.svg">
        </section>


        <section>
            <h2>Conclusions</h2>
            <ul>
                <li class="fragment fade-in">Kotlin provides many unique features to build DSLs easily</li>
                <li class="fragment fade-in">DSLs in Kotlin work best as configuration API</li>
                <li class="fragment fade-in">They can be a powerful abstraction over untyped data structures</li>
            </ul>
        </section>

        <section>
            <h2>Warning</h2>
            <ul>
                <li class="fragment fade-in">Most of the time a plain code is better than DSL</li>
                <li class="fragment fade-in">Provide a way to extend and bypass your DSL</li>
            </ul>
            <br><br>
            <div class="fragment fade-in">
            Don't use it for evil
            <pre><code style="overflow: hidden; width: 100%" class="kotlin hljs" data-trim>
class Ternary&lt;T&gt;(val expr: Boolean, val then: T) {
  operator fun div(elsе: T): T = if (expr) then else elsе
}

operator fun &lt;T&gt; Boolean.mod(a: T): Ternary&lt;T&gt; = Ternary(this, a)

val result = (5 == 2 + 3) % 1 / 2 // 1
            </code></pre>
                <a href="https://gist.github.com/naixx/9d94c1498c4d45ffda3a">gist.github.com/naixx/9d94c1498c4d45ffda3a</a>
            </div>
        </section>

        <section data-background-image="img/3.jpg">
            <h2>Thank you</h2>

            <p>Some resources:</p>
            <ul>
                <li>
                    Slides and code<br/>
                    <a href="https://github.com/SerCeMan/talk-fantastic-dsls">
                        github.com/SerCeMan/talk-fantastic-dsls
                    </a>
                </li>
                <br/>
                <li>
                    Building DSL Instead of an IDE Plugin<br/>
                    <a href="http://jonnyzzz.com/blog/2016/09/02/dsl-building/">
                        jonnyzzz.com/blog/2016/09/02/dsl-building
                    </a>
                </li>
                <br/>
                <li>
                    DSLs in Kotlin: The Good, the Bad and the Ugly<br/>
                    <a href="https://victor.kropp.name/blog/kotlin-dsls-good-bad-and-ugly/">
                        victor.kropp.name/blog/kotlin-dsls-good-bad-and-ugly
                    </a>
                </li>
            </ul>
        </section>
    </div>

</div>

<script type="text/javascript" src="components/reveal.js/lib/js/head.min.js"></script>
<script type="text/javascript" src="components/reveal.js/js/reveal.js"></script>
<script type="text/javascript" src="js/index.js"></script>

</body>
</html>
